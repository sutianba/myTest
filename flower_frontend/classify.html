<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ¸ èŠ±å‰åˆ†ç±»å±•ç¤º</title>
    <style>
        /* å…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        /* å®¹å™¨ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* å¤´éƒ¨ */
        .header {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            padding: 30px;
            text-align: center;
            margin-bottom: 0;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-content {
            padding: 30px;
        }

        /* åˆ†ç±»æ§åˆ¶åŒºåŸŸ */
        .classification-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .classification-controls h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .control-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .control-group button {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        }

        .control-group button.active {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(46, 204, 113, 0.4);
        }

        .control-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(46, 204, 113, 0.4);
        }

        /* åˆ†ç±»ç»“æœåŒºåŸŸ */
        .classification-results {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .classification-results h2 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        /* åˆ†ç±»é¡¹ */
        .classification-item {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .classification-item:last-child {
            border-bottom: none;
        }

        .classification-item h3 {
            margin-bottom: 15px;
            color: #667eea;
            font-size: 1.3em;
        }

        /* å›¾ç‰‡ç½‘æ ¼ */
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .image-card {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .image-card:hover {
            transform: translateY(-5px);
        }

        .image-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .image-info {
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
        }

        .image-info p {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .image-info p:last-child {
            margin-bottom: 0;
            font-size: 12px;
            opacity: 0.8;
        }

        /* è¿”å›æŒ‰é’® */
        .back-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 30px;
            border: none;
            border-radius: 8px;
            background: white;
            color: #667eea;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        /* å›¾ç‰‡æŸ¥çœ‹å™¨æ ·å¼ */
        .image-viewer {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .image-viewer.active {
            display: flex;
        }
        
        .viewer-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }
        
        .viewer-image {
            max-width: 100%;
            max-height: 80vh;
            cursor: zoom-in;
            transition: transform 0.2s;
        }
        
        .viewer-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
        }
        
        .viewer-btn {
            background-color: rgba(255, 255, 255, 0.3);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .viewer-btn:hover {
            background-color: rgba(255, 255, 255, 0.5);
        }
        
        .viewer-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0 20px;
            box-sizing: border-box;
        }
        
        .nav-btn {
            background-color: rgba(255, 255, 255, 0.3);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .nav-btn:hover {
            background-color: rgba(255, 255, 255, 0.5);
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .control-group {
                flex-direction: column;
                align-items: center;
            }

            .control-group button {
                width: 80%;
            }

            .image-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
        <div class="container">
            <div class="header">
                <h1>ğŸŒ¸ èŠ±å‰åˆ†ç±»å±•ç¤º</h1>
                <p>æŒ‰èŠ±å‰ç§ç±»æŸ¥çœ‹è¯†åˆ«ç»“æœ</p>
            </div>

            <div class="main-content">
                <div class="classification-controls">
                    <h2>é€‰æ‹©åˆ†ç±»æ ‡å‡†</h2>
                    <div class="control-group">
                        <button id="sortByTag" class="active">æŒ‰èŠ±å‰åç§°</button>
                        <button id="sortByLocation">æŒ‰åœ°ç†ä½ç½®</button>
                        <button id="sortByDate">æŒ‰æ‹æ‘„æ—¶é—´</button>
                    </div>
                </div>

                <div class="classification-results" id="classificationResults">
                    <h2>åˆ†ç±»ç»“æœ</h2>
                    <div id="flowerCategories"></div>
                </div>
                
                <button class="back-btn" onclick="goBack()">è¿”å›è¯†åˆ«é¡µé¢</button>
            </div>
        </div>
        
        <!-- å›¾ç‰‡æŸ¥çœ‹å™¨ -->
        <div class="image-viewer" id="imageViewer">
            <div class="viewer-content">
                <div class="viewer-controls">
                    <button class="viewer-btn" onclick="closeViewer()">Ã—</button>
                    <button class="viewer-btn" onclick="resetZoom()">âŸ²</button>
                </div>
                <div class="viewer-nav">
                    <button class="nav-btn" onclick="prevImage()">â€¹</button>
                    <button class="nav-btn" onclick="nextImage()">â€º</button>
                </div>
                <img class="viewer-image" id="viewerImage" src="" alt="æŸ¥çœ‹å›¾ç‰‡">
            </div>
        </div>

    <script>
        // è·å–ä»ä¸»é¡µé¢ä¼ é€’çš„è¯†åˆ«ç»“æœ
        let allResults = [];
        let currentImages = []; // å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰å›¾ç‰‡
        let currentImageIndex = 0; // å½“å‰æŸ¥çœ‹çš„å›¾ç‰‡ç´¢å¼•
        let zoomLevel = 1; // å½“å‰ç¼©æ”¾çº§åˆ«
        let isDragging = false; // æ˜¯å¦æ­£åœ¨æ‹–åŠ¨
        let startX, startY, translateX = 0, translateY = 0; // æ‹–åŠ¨ç›¸å…³å˜é‡
        
        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        window.addEventListener('DOMContentLoaded', () => {
            // ä»localStorageè·å–è¯†åˆ«ç»“æœ
            const savedResults = localStorage.getItem('flowerRecognitionResults');
            if (savedResults) {
                allResults = JSON.parse(savedResults);
                console.log('åŠ è½½äº†', allResults.length, 'ä¸ªè¯†åˆ«ç»“æœ');
                // é»˜è®¤æŒ‰èŠ±å‰åç§°åˆ†ç±»æ˜¾ç¤º
                sortByTag();
            } else {
                // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ˜¾ç¤ºæç¤º
                showEmptyState();
            }
        });

        // åˆ†ç±»æŒ‰é’®äº‹ä»¶ç›‘å¬
        document.getElementById('sortByDate').addEventListener('click', () => {
            setActiveButton('sortByDate');
            sortByDate();
        });

        document.getElementById('sortByLocation').addEventListener('click', () => {
            setActiveButton('sortByLocation');
            sortByLocation();
        });

        document.getElementById('sortByTag').addEventListener('click', () => {
            setActiveButton('sortByTag');
            sortByTag();
        });

        // è®¾ç½®æ´»åŠ¨æŒ‰é’®æ ·å¼
        function setActiveButton(buttonId) {
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
            document.querySelectorAll('.control-group button').forEach(btn => {
                btn.classList.remove('active');
            });
            // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
            document.getElementById(buttonId).classList.add('active');
        }

        // æŒ‰æ—¶é—´åˆ†ç±»
        function sortByDate() {
            if (allResults.length === 0) {
                showEmptyState();
                return;
            }

            // æŒ‰æ—¥æœŸåˆ†ç»„
            const dateGroups = {};
            
            allResults.forEach(result => {
                // ä»EXIFä¿¡æ¯è·å–æ‹æ‘„æ—¶é—´
                let date = 'æœªçŸ¥æ—¶é—´';
                if (result.exif_info && result.exif_info.date_time) {
                    // æ ¼å¼åŒ–æ—¥æœŸ (YYYY-MM-DD)
                    date = result.exif_info.date_time.split(' ')[0];
                } else {
                    // å¦‚æœæ²¡æœ‰EXIFæ—¶é—´ï¼Œä½¿ç”¨æ–‡ä»¶ä¿®æ”¹æ—¶é—´
                    date = new Date(result.file.lastModified).toISOString().split('T')[0];
                }

                if (!dateGroups[date]) {
                    dateGroups[date] = [];
                }
                dateGroups[date].push(result);
            });

            // æ˜¾ç¤ºåˆ†ç»„ç»“æœ
            displayClassificationResults(dateGroups, 'æ—¥æœŸ');
        }

        // æŒ‰åœ°ç†ä¿¡æ¯åˆ†ç±»
        function sortByLocation() {
            if (allResults.length === 0) {
                showEmptyState();
                return;
            }

            // æŒ‰åœ°ç†ä½ç½®åˆ†ç»„
            const locationGroups = {};
            
            allResults.forEach(result => {
                // ä»EXIFä¿¡æ¯è·å–åœ°ç†ä½ç½®
                let location = 'æœªçŸ¥ä½ç½®';
                if (result.exif_info && result.exif_info.location && result.exif_info.location.formatted_address) {
                    location = result.exif_info.location.formatted_address;
                } else if (result.exif_info && result.exif_info.location && result.exif_info.location.latitude) {
                    // å¦‚æœæœ‰ç»çº¬åº¦ä½†æ²¡æœ‰æ ¼å¼åŒ–åœ°å€ï¼Œä½¿ç”¨ç»çº¬åº¦
                    const lat = result.exif_info.location.latitude;
                    const lon = result.exif_info.location.longitude;
                    location = `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
                }

                if (!locationGroups[location]) {
                    locationGroups[location] = [];
                }
                locationGroups[location].push(result);
            });

            // æ˜¾ç¤ºåˆ†ç»„ç»“æœ
            displayClassificationResults(locationGroups, 'åœ°ç†ä½ç½®');
        }

        // æŒ‰æ ‡ç­¾åˆ†ç±»
        function sortByTag() {
            if (allResults.length === 0) {
                showEmptyState();
                return;
            }

            // æŒ‰æ ‡ç­¾åˆ†ç»„
            const tagGroups = {};
            
            allResults.forEach(result => {
                if (result.detections && result.detections.length > 0) {
                    // è·å–ç¬¬ä¸€ä¸ªæ£€æµ‹ç»“æœçš„æ ‡ç­¾
                    const tag = result.detections[0].name || 'æœªçŸ¥èŠ±å‰';
                    
                    if (!tagGroups[tag]) {
                        tagGroups[tag] = [];
                    }
                    tagGroups[tag].push(result);
                } else {
                    // å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°èŠ±å‰ï¼Œæ”¾å…¥"æœªè¯†åˆ«"åˆ†ç»„
                    if (!tagGroups['æœªè¯†åˆ«']) {
                        tagGroups['æœªè¯†åˆ«'] = [];
                    }
                    tagGroups['æœªè¯†åˆ«'].push(result);
                }
            });

            // ä¿å­˜å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰å›¾ç‰‡ï¼Œç”¨äºæŸ¥çœ‹å™¨å¯¼èˆª
            currentImages = Object.values(tagGroups).flat();
            
            // æ˜¾ç¤ºåˆ†ç»„ç»“æœ
            displayClassificationResults(tagGroups, 'èŠ±å‰ç§ç±»');
        }

        // æ˜¾ç¤ºåˆ†ç±»ç»“æœ
        function displayClassificationResults(groups, groupType) {
            const resultsContainer = document.getElementById('classificationResults');
            
            // æ¸…ç©ºå®¹å™¨
            resultsContainer.innerHTML = '<h2>åˆ†ç±»ç»“æœ</h2>';
            
            // å¦‚æœæ²¡æœ‰åˆ†ç»„ç»“æœ
            if (Object.keys(groups).length === 0) {
                showEmptyState();
                return;
            }
            
            // ä¿å­˜å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰å›¾ç‰‡ï¼Œç”¨äºæŸ¥çœ‹å™¨å¯¼èˆª
            currentImages = Object.values(groups).flat();
            
            // åˆ›å»ºå¹¶æ·»åŠ åˆ†ç±»é¡¹
            Object.keys(groups).forEach(groupKey => {
                const groupItems = groups[groupKey];
                
                // åˆ›å»ºåˆ†ç±»é¡¹å®¹å™¨
                const classificationItem = document.createElement('div');
                classificationItem.className = 'classification-item';
                
                // åˆ›å»ºåˆ†ç±»æ ‡é¢˜
                const groupTitle = document.createElement('h3');
                groupTitle.textContent = `${groupType}: ${groupKey} (${groupItems.length}å¼ )`;
                classificationItem.appendChild(groupTitle);
                
                // åˆ›å»ºå›¾ç‰‡ç½‘æ ¼
                const imageGrid = document.createElement('div');
                imageGrid.className = 'image-grid';
                
                // æ·»åŠ å›¾ç‰‡å¡ç‰‡
                groupItems.forEach(result => {
                    const imageCard = createImageCard(result);
                    imageGrid.appendChild(imageCard);
                });
                
                classificationItem.appendChild(imageGrid);
                resultsContainer.appendChild(classificationItem);
            });
        }

        // åˆ›å»ºå›¾ç‰‡å¡ç‰‡
        function createImageCard(result) {
            const imageCard = document.createElement('div');
            imageCard.className = 'image-card';
            
            // åˆ›å»ºå›¾ç‰‡
            const img = document.createElement('img');
            img.src = result.thumbnailData;
            img.alt = 'èŠ±å‰å›¾ç‰‡';
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œæ‰“å¼€å›¾ç‰‡æŸ¥çœ‹å™¨
            img.addEventListener('click', () => {
                openViewer(result);
            });
            imageCard.appendChild(img);
            
            // åˆ›å»ºå›¾ç‰‡ä¿¡æ¯
            const imageInfo = document.createElement('div');
            imageInfo.className = 'image-info';
            
            // æ·»åŠ èŠ±å‰åç§°
            const flowerName = document.createElement('p');
            flowerName.textContent = result.detections && result.detections.length > 0 
                ? result.detections[0].name || 'æœªçŸ¥èŠ±å‰' 
                : 'æœªè¯†åˆ«';
            imageInfo.appendChild(flowerName);
            
            // æ·»åŠ æ—¶é—´ä¿¡æ¯
            const dateInfo = document.createElement('p');
            let dateText = 'æœªçŸ¥æ—¶é—´';
            if (result.exif_info && result.exif_info.date_time) {
                dateText = result.exif_info.date_time;
            } else {
                dateText = new Date(result.file.lastModified).toLocaleString();
            }
            dateInfo.textContent = dateText;
            imageInfo.appendChild(dateInfo);
            
            imageCard.appendChild(imageInfo);
            
            return imageCard;
        }

        // æ˜¾ç¤ºç©ºçŠ¶æ€
        function showEmptyState() {
            const resultsContainer = document.getElementById('classificationResults');
            resultsContainer.innerHTML = 
                '<h2>åˆ†ç±»ç»“æœ</h2>' +
                '<div class="empty-state">' +
                    '<p>æ²¡æœ‰æ‰¾åˆ°å¯åˆ†ç±»çš„ç»“æœ</p>' +
                '</div>';
        }

        // æ‰“å¼€å›¾ç‰‡æŸ¥çœ‹å™¨
        function openViewer(result) {
            const viewer = document.getElementById('imageViewer');
            const viewerImage = document.getElementById('viewerImage');
            
            // è®¾ç½®å›¾ç‰‡æº
            viewerImage.src = result.thumbnailData;
            
            // é‡ç½®ç¼©æ”¾å’Œä½ç½®
            resetZoom();
            
            // è®°å½•å½“å‰å›¾ç‰‡ç´¢å¼•
            currentImageIndex = currentImages.findIndex(item => item.file.name === result.file.name);
            
            // æ˜¾ç¤ºæŸ¥çœ‹å™¨
            viewer.classList.add('active');
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬
            viewerImage.addEventListener('wheel', handleWheel);
            viewerImage.addEventListener('mousedown', handleMouseDown);
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
        }
        
        // å…³é—­å›¾ç‰‡æŸ¥çœ‹å™¨
        function closeViewer() {
            const viewer = document.getElementById('imageViewer');
            const viewerImage = document.getElementById('viewerImage');
            
            // éšè—æŸ¥çœ‹å™¨
            viewer.classList.remove('active');
            
            // ç§»é™¤äº‹ä»¶ç›‘å¬
            viewerImage.removeEventListener('wheel', handleWheel);
            viewerImage.removeEventListener('mousedown', handleMouseDown);
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseUp);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåï¼Œæ·»åŠ ç‚¹å‡»èƒŒæ™¯å…³é—­æŸ¥çœ‹å™¨çš„åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', () => {
            const viewer = document.getElementById('imageViewer');
            const viewerContent = viewer.querySelector('.viewer-content');
            
            // ç‚¹å‡»æŸ¥çœ‹å™¨èƒŒæ™¯å…³é—­æŸ¥çœ‹å™¨
            viewer.addEventListener('click', (e) => {
                if (e.target === viewer) {
                    closeViewer();
                }
            });
            
            // æ·»åŠ é”®ç›˜äº‹ä»¶æ”¯æŒ
            document.addEventListener('keydown', (e) => {
                if (viewer.classList.contains('active')) {
                    switch (e.key) {
                        case 'Escape':
                            closeViewer();
                            break;
                        case 'ArrowLeft':
                            prevImage();
                            break;
                        case 'ArrowRight':
                            nextImage();
                            break;
                        case 'r':
                        case 'R':
                            resetZoom();
                            break;
                    }
                }
            });
        });
        
        // é‡ç½®ç¼©æ”¾
        function resetZoom() {
            const viewerImage = document.getElementById('viewerImage');
            zoomLevel = 1;
            translateX = 0;
            translateY = 0;
            viewerImage.style.transform = 'scale(1) translate(0, 0)';
            viewerImage.style.cursor = 'zoom-in';
        }
        
        // å¤„ç†é¼ æ ‡æ»šè½®ç¼©æ”¾
        function handleWheel(e) {
            e.preventDefault();
            
            const viewerImage = document.getElementById('viewerImage');
            const rect = viewerImage.getBoundingClientRect();
            const centerX = e.clientX - rect.left;
            const centerY = e.clientY - rect.top;
            
            // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
            const scaleFactor = e.deltaY > 0 ? 0.9 : 1.1;
            const newZoomLevel = Math.max(0.5, Math.min(zoomLevel * scaleFactor, 5));
            
            // è®¡ç®—ç¼©æ”¾åçš„ä½ç½®åç§»
            const scaleChange = newZoomLevel / zoomLevel;
            translateX = centerX - (centerX - translateX) * scaleChange;
            translateY = centerY - (centerY - translateY) * scaleChange;
            
            // æ›´æ–°ç¼©æ”¾çº§åˆ«å’Œä½ç½®
            zoomLevel = newZoomLevel;
            viewerImage.style.transform = `scale(${zoomLevel}) translate(${translateX}px, ${translateY}px)`;
            
            // æ›´æ–°é¼ æ ‡æ ·å¼
            viewerImage.style.cursor = zoomLevel > 1 ? 'grab' : 'zoom-in';
        }
        
        // å¤„ç†é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
        function handleMouseDown(e) {
            if (zoomLevel <= 1) return;
            
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            
            const viewerImage = document.getElementById('viewerImage');
            viewerImage.style.cursor = 'grabbing';
        }
        
        // å¤„ç†é¼ æ ‡ç§»åŠ¨äº‹ä»¶
        function handleMouseMove(e) {
            if (!isDragging) return;
            
            const viewerImage = document.getElementById('viewerImage');
            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;
            
            // æ›´æ–°ä½ç½®
            translateX += deltaX;
            translateY += deltaY;
            
            // åº”ç”¨å˜æ¢
            viewerImage.style.transform = `scale(${zoomLevel}) translate(${translateX}px, ${translateY}px)`;
            
            // æ›´æ–°èµ·å§‹ä½ç½®
            startX = e.clientX;
            startY = e.clientY;
        }
        
        // å¤„ç†é¼ æ ‡é‡Šæ”¾äº‹ä»¶
        function handleMouseUp() {
            isDragging = false;
            
            const viewerImage = document.getElementById('viewerImage');
            viewerImage.style.cursor = zoomLevel > 1 ? 'grab' : 'zoom-in';
        }
        
        // æŸ¥çœ‹ä¸Šä¸€å¼ å›¾ç‰‡
        function prevImage() {
            if (currentImages.length === 0) return;
            
            currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
            openViewer(currentImages[currentImageIndex]);
        }
        
        // æŸ¥çœ‹ä¸‹ä¸€å¼ å›¾ç‰‡
        function nextImage() {
            if (currentImages.length === 0) return;
            
            currentImageIndex = (currentImageIndex + 1) % currentImages.length;
            openViewer(currentImages[currentImageIndex]);
        }
        
        // è¿”å›ä¸»é¡µé¢
        function goBack() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>